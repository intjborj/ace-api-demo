package com.hisd3.hismk2.rest

import groovy.util.logging.Slf4j
import com.google.gson.Gson
import com.google.gson.JsonObject
import com.hisd3.hismk2.domain.Department
import com.hisd3.hismk2.domain.ancillary.*
import com.hisd3.hismk2.domain.pms.Case
import com.hisd3.hismk2.domain.pms.FileAttachment
import com.hisd3.hismk2.graphqlservices.billing.RfDetails
import com.hisd3.hismk2.repository.DepartmentRepository
import com.hisd3.hismk2.repository.ancillary.*
import com.hisd3.hismk2.repository.billing.BillingItemRepository
import com.hisd3.hismk2.repository.pms.CaseRepository
import com.hisd3.hismk2.repository.pms.FileAttachmentRepository
import groovy.json.JsonBuilder
import groovy.transform.TypeChecked
import jcifs.smb.NtlmPasswordAuthentication
import jcifs.smb.SmbFile
import jcifs.smb.SmbFileInputStream
import jcifs.smb.SmbFileOutputStream
import org.apache.commons.csv.CSVFormat
import org.apache.commons.csv.CSVPrinter
import org.apache.commons.io.FilenameUtils
import org.apache.commons.lang3.StringUtils
import org.apache.tika.Tika
import org.apache.xmlbeans.impl.xb.xsdschema.AnyDocument
import org.json.JSONArray
import org.json.JSONObject
import org.springframework.beans.factory.annotation.Autowired
import org.springframework.http.HttpHeaders
import org.springframework.http.HttpStatus
import org.springframework.http.MediaType
import org.springframework.http.ResponseEntity
import org.springframework.jdbc.core.JdbcTemplate
import org.springframework.transaction.annotation.Transactional
import org.springframework.util.LinkedMultiValueMap
import org.springframework.web.bind.annotation.*
import org.springframework.web.context.request.async.DeferredResult
import org.springframework.web.multipart.MultipartFile
import org.springframework.web.multipart.MultipartRequest
import sun.misc.BASE64Decoder
import sun.rmi.runtime.Log

import javax.imageio.ImageIO
import java.awt.*
import java.awt.image.BufferedImage
import java.sql.Timestamp
import java.text.SimpleDateFormat
import java.time.Instant
import java.time.LocalDate
import java.time.ZoneId
import java.time.format.DateTimeFormatter
import java.util.List
import java.util.concurrent.CompletableFuture
import java.util.concurrent.ForkJoinPool

@TypeChecked
@RestController
@Slf4j
class OrderslipResource {

	@Autowired
	OrderSlipItemRepository orderSlipItemRepository

	@Autowired
	DiagnosticsResultRepository diagnosticsResultRepository

	@Autowired
	IntegrationConfigRepository integrationConfigRepository

	@Autowired
	CaseRepository caseRepository

	@Autowired
	FileAttachmentRepository fileAttachmentRepository

	@Autowired
	JdbcTemplate jdbcTemplate

	@Autowired
	ServiceRepository serviceRepository

	@Autowired
	RfFeesRepository	rfFeesRepository

	@Autowired
	BillingItemRepository billingItemRepository

	@Autowired
	DepartmentRepository 	departmentRepository

	BufferedImage resize(BufferedImage img , Integer newH) {
		Integer oldH = img.height
		Integer oldW = img.width
		Number heightPercent = newH.div(oldH)
		Integer newW = (oldW*heightPercent)

		def tmp = img.getScaledInstance(newW, newH, Image.SCALE_SMOOTH)
		BufferedImage dimg = new BufferedImage(newW, newH, BufferedImage.SCALE_SMOOTH)

		def g2d = dimg.createGraphics()
		g2d.drawImage(tmp, 0, 0, null)
		g2d.dispose()

		return dimg
	}

	@RequestMapping(method = [RequestMethod.GET], value = "/api/orderSlipItem/getImageResults/{id}")
	String getImageResults(@PathVariable(value = "id") String id) {

		HttpHeaders responseHeaders = new HttpHeaders()

		DiagnosticResult resultImage = diagnosticsResultRepository.findById(UUID.fromString(id)).get()
		if (resultImage != null) {
			if (resultImage.url_path != null) {

				//NtlmPasswordAuthentication ntlmPasswordAuthentication = new NtlmPasswordAuthentication(null, "hisd3", "xsXY4;")
				IntegrationConfig integrationConfig = integrationConfigRepository.findAll().first()

				NtlmPasswordAuthentication ntlmPasswordAuthentication = new NtlmPasswordAuthentication(null, integrationConfig.smbUser, integrationConfig.smbPass)

				SmbFile attachementfile = new SmbFile(resultImage.url_path, ntlmPasswordAuthentication)

				SmbFileInputStream finput = new SmbFileInputStream(attachementfile)
				byte[] imageBytes = new byte[(int) attachementfile.length()]
				finput.read(imageBytes, 0, imageBytes.length)
				finput.close()
				String imageStr = imageBytes.encodeBase64().toString()

				return "data:"+resultImage.mimetype+";base64,"+imageStr
			}
		} else {
			return "data:image/png;base64,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"
		}

	}

    @RequestMapping(method = [RequestMethod.GET], value = "/api/patient/getAttachment/{id}")
    ResponseEntity<byte[]> getAttachment(@PathVariable(value = "id") String id) throws IOException{

        FileAttachment resultPhoto = fileAttachmentRepository.findById(UUID.fromString(id)).get()
        if (resultPhoto != null) {
            if (resultPhoto.urlPath != null) {
                try{
                    //NtlmPasswordAuthentication ntlmPasswordAuthentication = new NtlmPasswordAuthentication(null, "hisd3", "xsXY4;")
                    IntegrationConfig integrationConfig = integrationConfigRepository.findAll().first()

                    NtlmPasswordAuthentication ntlmPasswordAuthentication = new NtlmPasswordAuthentication(null, integrationConfig.smbUser, integrationConfig.smbPass)

                    SmbFile attachementfile = new SmbFile(resultPhoto.urlPath, ntlmPasswordAuthentication)

                    SmbFileInputStream finput = new SmbFileInputStream(attachementfile)

                    ByteArrayOutputStream buffer = new ByteArrayOutputStream()
                    int nRead

                    byte[] data = new byte[(int) attachementfile.length()]

                    while ((nRead = finput.read(data, 0, data.length)) != -1) {
                        buffer.write(data, 0, nRead)
                    }

                    def mime = new Tika().detect(data)

                    LinkedMultiValueMap<String, String> extHeaders = new LinkedMultiValueMap<>()
                    extHeaders.add("Content-Type",mime)
                    extHeaders.add("Content-Disposition", 'inline;filename="'+attachementfile.getName()+'"')

                    return new ResponseEntity(buffer.toByteArray(),
                            extHeaders, HttpStatus.OK)

                }catch(Exception e){
                    throw new IOException("Problem on file server "+ e)
                }

            }
        }
        throw new IOException("File not Found")
    }



    String  getThumbAttachment(UUID id) {

		HttpHeaders responseHeaders = new HttpHeaders()

		FileAttachment resultPhoto = fileAttachmentRepository.findById(id).get()

		if (resultPhoto != null) {
			if (resultPhoto.urlPath != null) {

				//NtlmPasswordAuthentication ntlmPasswordAuthentication = new NtlmPasswordAuthentication(null, "hisd3", "xsXY4;")
				IntegrationConfig integrationConfig = integrationConfigRepository.findAll().first()

				NtlmPasswordAuthentication ntlmPasswordAuthentication = new NtlmPasswordAuthentication(null, integrationConfig.smbUser, integrationConfig.smbPass)

				SmbFile attachementfile = new SmbFile(resultPhoto.urlPath, ntlmPasswordAuthentication)

				SmbFileInputStream finput = new SmbFileInputStream(attachementfile)
				BufferedInputStream buff = new BufferedInputStream(finput)
				BufferedImage img = ImageIO.read(buff)
				try {

					img = resize(img, 200)
					ByteArrayOutputStream os = new ByteArrayOutputStream()
					ImageIO.write(img, "jpg", os)


					String  base64bytes = Base64.getEncoder().encodeToString(os.toByteArray())

					if(resultPhoto.mimetype == "image/jpeg" || resultPhoto.mimetype == "image/png"){
						return "data:" + resultPhoto.mimetype + ";base64," + base64bytes
					}else{
						return "data:image/png;base64,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"
					}
				}
				catch (Exception e){
					return "data:image/png;base64,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"

				}

			}
		}

	}

	@RequestMapping(method = [RequestMethod.GET], value = "/api/patient/get_thumb_attachment/{id}")
	ResponseEntity<byte[]> getImage(@PathVariable(value = "id") String id){
		FileAttachment resultPhoto = fileAttachmentRepository.findById(UUID.fromString(id)).get()
		if (resultPhoto != null) {
			if (resultPhoto.urlPath != null) {
				IntegrationConfig integrationConfig = integrationConfigRepository.findAll().first()

				NtlmPasswordAuthentication ntlmPasswordAuthentication = new NtlmPasswordAuthentication(null, integrationConfig.smbUser, integrationConfig.smbPass)

				SmbFile attachementfile = new SmbFile(resultPhoto.urlPath, ntlmPasswordAuthentication)
				SmbFileInputStream finput = new SmbFileInputStream(attachementfile)
				BufferedInputStream buff = new BufferedInputStream(finput)
				ByteArrayOutputStream os = new ByteArrayOutputStream()


				if(resultPhoto.mimetype == "image/jpeg" || resultPhoto.mimetype == "image/png") {
					BufferedImage img = ImageIO.read(buff)

					img = resize(img, 200)

					ImageIO.write(img, "jpg", os)
					os.flush()
				}
				else{

					byte[] imageByte
					try {
						def imageString = "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EKrUbVpkkmVVokF4cmm0OwzqpVFX6bi4MPwhfjaGYBJySuY0m/IFw2eELQaG4BIpTDaSeYLhs8IWg0NlvCSyjbDsllB2G5P4VG2HZLKDsNyfwqNsOyWUHYbk/hUbYdksmN+gVPDN/Cnt+sVPFNZT8OKcTu3+FTcOEcbuyyquEoNIX4jWb9L+oqeC7oLM4XAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmU0F3SWZyvymq36WdZVVokAoH/ST/2gAIAQEDAT8h/wDInzQdb5AZrUX+BCF5zPIhqbEtfjAfxmzZs2bNmzZs2NCzq3lpxqDjUHGoONQcag41BxqDjUHGoONQcag41BxqDjUHGoONQcag41BxqDjUHGoONQcag41BxqDjUHGoONQcag41BxqDjUHGoONQcag41BxqDjUHGoONQcag41BxqDjUHGoONQcag41BxqBKVzQvB/DNmzZs2bNm4sS1+MhUX+JGB5RHIgo80nS+YmSbQLycXDbpfb/igWkYuO3W+m1dnQXO95f+KszqDna8m1vPT/xW89e1vPT/AEGFa0W/at/pcb+Kh7p8BdHdadJr7R/LWQz5q/LUeA81odI/urWeGWPBrfS80V8qzeKFWbpP3qZw99vPXtbz0+9kLtIcp6LHdpWne8zfFXYR7u+P8YsING9TJV0+xavyauq+qOktWpzPebz17W89PvAOOIw5mBR8ADsz60AILBl7Bv4z/rrWV8LubmJRxxMEv7reeva3np901bMLU4XF4fgVCdoHtHTi4vmMuZSqDxQ5mp7neeva3np9z0+hdOgVm4OP+R9uGdAQ5ND7Dwt0eHuN569reen3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kgkkkkkkkkkkkkkkkkkkkkkkkgkkggEkkkgEkkkkkAkkkkkkkkkkkkkkkkkkkkgkkgkkgAkkkkgkkkkkkgkkkkkkkkkkkkkkkkkkkkgkkgkkkEkgEAAkkkkkkEkkkkkkkkkkkkkkkkkkkkkEkgkkkAAkgkEkkkkkkAkkkkkkkkkkkkkkkkkkkkkEkkkkkgEAEgkkkkkkkgkkkkkkkkkkkkkkkkkkkkkgkkkkkkkEkEkkkkkkkgkkkkkkkkkkkkkkkkkkkkkgkgkkkkkkkkkkkkkkAkkkkkkkkkkkkkkkkkkkkkkkEkAgkkkkkkkkggkkgEkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkgkkkkkkkkkkkkkkkkkkkkkkkAkkkkkkkkkkkkkkEEkkkkkkkkkkkkkkkkkkkkkkkkEkkkkkkkkkkkkkkEkkkkkkkkkkkkkkkkkkkkkkkkAkkkkkkkkkkkkkAkkkkkkkkkkkkkkkkkkkkkkkkkkEkkkkkkkkkkgkAkkkkkkkkkkkkkkkkkkkkkkkkkkAkkkkkkkkkkkAkkkkkkkkkkkkkkkkkkkkkkkkkkkggkkkkkkkkAAEkkkkkkkkkkkkkkkkkkkkkkkkkkkkkEkkkkkkAkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkAkkkEkgkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkgEAEEkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkggkggkgEkkEEgEEgkEEgggAkgkAgkEEkkkkkkkkkkkEkAkAEkEEEggAkkkggEgkkkAkkkkEkkkkkkkkkkgggEAkgkEEkkkkkkkkgkgkkkggEkkkkkkkkkkkkkkgggEEggkgEkkEkggEkAgkkEgAEkAEkkkkkkkkkkggAkAEkEkkgkAkkkkkgggkgkkkEkEkkkkkkkkkkgkkAEkggkEEEgEgkgggEkkEgkEAggkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk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"
						BASE64Decoder decoder = new BASE64Decoder()
						imageByte = decoder.decodeBuffer(imageString)
						ByteArrayInputStream bis = new ByteArrayInputStream(imageByte)
						BufferedImage image = ImageIO.read(bis)
						bis.close()

						ImageIO.write(image, "jpg", os)
						os.flush()

					} catch (Exception e) {
						e.printStackTrace()
					}

				}
				HttpHeaders responseHeaders = new HttpHeaders()
				responseHeaders.setContentType(MediaType.IMAGE_JPEG)
				responseHeaders.setContentLength(os.toByteArray().size().toLong())

				return new ResponseEntity(os.toByteArray(),
						responseHeaders, HttpStatus.OK)
			}
		}
	}

	def resizer(File orignalImage,int width,int height,String extension) {

		try {
			BufferedImage origBuffImg = ImageIO.read(orignalImage)
			int type = origBuffImg.getType() == 0 ? BufferedImage.TYPE_INT_ARGB : origBuffImg.getType()

			BufferedImage resizedBuffImg = new BufferedImage(width, height, type)
			Graphics2D g = resizedBuffImg.createGraphics()
			g.drawImage(origBuffImg, 0, 0, width, height, null)
			g.dispose()

			String newFile = orignalImage.getAbsolutePath().substring(0, orignalImage.getAbsolutePath().lastIndexOf(".")) + "_" + width + "x" + height + "." + extension
			ImageIO.write(resizedBuffImg, extension, new File(newFile))

			System.out.println("File created : " + newFile)

		} catch (IOException e) {
			e.printStackTrace()
		}
	}


	@GetMapping("/api/patient/get_thumb_attachment_deferred_result/{id}")
	DeferredResult<ResponseEntity<byte[]>> handleReqDefResult(@PathVariable(value = "id") String id) {
		log.info("Received async-deferredresult request");
		DeferredResult<ResponseEntity<byte[]>> deferredResult = new DeferredResult<>();

		CompletableFuture.supplyAsync({ ->
			log.info("Processing in separate thread");
			FileAttachment resultPhoto = fileAttachmentRepository.findById(UUID.fromString(id)).orElse(null);
			if (resultPhoto != null) {
				if (resultPhoto.getUrlPath() != null) {
					IntegrationConfig integrationConfig = integrationConfigRepository.findAll().first();
					NtlmPasswordAuthentication ntlmPasswordAuthentication = new NtlmPasswordAuthentication(null, integrationConfig.getSmbUser(), integrationConfig.getSmbPass());

					try {
						SmbFile attachementfile = new SmbFile(resultPhoto.getUrlPath(), ntlmPasswordAuthentication);
						SmbFileInputStream finput = new SmbFileInputStream(attachementfile);
						BufferedInputStream buff = new BufferedInputStream(finput);
						ByteArrayOutputStream os = new ByteArrayOutputStream();

						if (resultPhoto.getMimetype().equals("image/jpeg") || resultPhoto.getMimetype().equals("image/png")) {
							BufferedImage img = ImageIO.read(buff);
							img = resize(img, 200);
							ImageIO.write(img, "jpg", os);
							os.flush();
						} else {
							byte[] imageByte
							try {
								def imageString = "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EKrUbVpkkmVVokF4cmm0OwzqpVFX6bi4MPwhfjaGYBJySuY0m/IFw2eELQaG4BIpTDaSeYLhs8IWg0NlvCSyjbDsllB2G5P4VG2HZLKDsNyfwqNsOyWUHYbk/hUbYdksmN+gVPDN/Cnt+sVPFNZT8OKcTu3+FTcOEcbuyyquEoNIX4jWb9L+oqeC7oLM4XAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmXAfueZcB+55lwH7nmU0F3SWZyvymq36WdZVVokAoH/ST/2gAIAQEDAT8h/wDInzQdb5AZrUX+BCF5zPIhqbEtfjAfxmzZs2bNmzZs2NCzq3lpxqDjUHGoONQcag41BxqDjUHGoONQcag41BxqDjUHGoONQcag41BxqDjUHGoONQcag41BxqDjUHGoONQcag41BxqDjUHGoONQcag41BxqDjUHGoONQcag41BxqDjUHGoONQcag41BxqBKVzQvB/DNmzZs2bNm4sS1+MhUX+JGB5RHIgo80nS+YmSbQLycXDbpfb/igWkYuO3W+m1dnQXO95f+KszqDna8m1vPT/xW89e1vPT/AEGFa0W/at/pcb+Kh7p8BdHdadJr7R/LWQz5q/LUeA81odI/urWeGWPBrfS80V8qzeKFWbpP3qZw99vPXtbz0+9kLtIcp6LHdpWne8zfFXYR7u+P8YsING9TJV0+xavyauq+qOktWpzPebz17W89PvAOOIw5mBR8ADsz60AILBl7Bv4z/rrWV8LubmJRxxMEv7reeva3np901bMLU4XF4fgVCdoHtHTi4vmMuZSqDxQ5mp7neeva3np9z0+hdOgVm4OP+R9uGdAQ5ND7Dwt0eHuN569reen3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kgkkkkkkkkkkkkkkkkkkkkkkkgkkggEkkkgEkkkkkAkkkkkkkkkkkkkkkkkkkkgkkgkkgAkkkkgkkkkkkgkkkkkkkkkkkkkkkkkkkkgkkgkkkEkgEAAkkkkkkEkkkkkkkkkkkkkkkkkkkkkEkgkkkAAkgkEkkkkkkAkkkkkkkkkkkkkkkkkkkkkEkkkkkgEAEgkkkkkkkgkkkkkkkkkkkkkkkkkkkkkgkkkkkkkEkEkkkkkkkgkkkkkkkkkkkkkkkkkkkkkgkgkkkkkkkkkkkkkkAkkkkkkkkkkkkkkkkkkkkkkkEkAgkkkkkkkkggkkgEkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkgkkkkkkkkkkkkkkkkkkkkkkkAkkkkkkkkkkkkkkEEkkkkkkkkkkkkkkkkkkkkkkkkEkkkkkkkkkkkkkkEkkkkkkkkkkkkkkkkkkkkkkkkAkkkkkkkkkkkkkAkkkkkkkkkkkkkkkkkkkkkkkkkkEkkkkkkkkkkgkAkkkkkkkkkkkkkkkkkkkkkkkkkkAkkkkkkkkkkkAkkkkkkkkkkkkkkkkkkkkkkkkkkkggkkkkkkkkAAEkkkkkkkkkkkkkkkkkkkkkkkkkkkkkEkkkkkkAkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkAkkkEkgkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkgEAEEkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkggkggkgEkkEEgEEgkEEgggAkgkAgkEEkkkkkkkkkkkEkAkAEkEEEggAkkkggEgkkkAkkkkEkkkkkkkkkkgggEAkgkEEkkkkkkkkgkgkkkggEkkkkkkkkkkkkkkgggEEggkgEkkEkggEkAgkkEgAEkAEkkkkkkkkkkggAkAEkEkkgkAkkkkkgggkgkkkEkEkkkkkkkkkkgkkAEkggkEEEgEgkgggEkkEgkEAggkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk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"
								BASE64Decoder decoder = new BASE64Decoder()
								imageByte = decoder.decodeBuffer(imageString)
								ByteArrayInputStream bis = new ByteArrayInputStream(imageByte)
								BufferedImage image = ImageIO.read(bis)
								bis.close()

								ImageIO.write(image, "jpg", os)
								os.flush()

							} catch (Exception e) {
								e.printStackTrace()
							}
						}

						byte[] imageBytes = os.toByteArray();
						return new ResponseEntity<>(imageBytes, HttpStatus.OK);
					} catch (IOException ignored) {
						// Handle IO exception
						return new ResponseEntity<>(HttpStatus.INTERNAL_SERVER_ERROR);
					}
				} else {
					// Handle missing URL path
					return new ResponseEntity<>(HttpStatus.NOT_FOUND);
				}
			} else {
				// Handle missing file attachment
				return new ResponseEntity<>(HttpStatus.NOT_FOUND);
			}
		}).whenCompleteAsync({ result, error ->
			if (error != null) {
				// Handle exception
				deferredResult.setErrorResult(new ResponseEntity<>(HttpStatus.INTERNAL_SERVER_ERROR));
			} else {
				deferredResult.setResult(result as ResponseEntity<byte[]>);
			}
		});

		log.info("servlet thread freed");
		return deferredResult;
	}

	@Transactional
	@RequestMapping(method = RequestMethod.POST, value = "/api/patient/addphotos")
	ResponseEntity<String> addphotos(@RequestParam String id, MultipartRequest request) {

		def activeCase = caseRepository.findById(UUID.fromString(id)).get()
		def file_attachment = request.getFiles("file")

		try {
			file_attachment.forEach {
				file ->
					MultipartFile f = file
					FileAttachment newAttachment = new FileAttachment()
					newAttachment.patient = activeCase.patient
					newAttachment.patientCase = activeCase
					newAttachment.fileName = f.originalFilename
					newAttachment.mimetype = f.contentType
					try {
						/*** ready for NAS***/
						String origin = f.resource.filename
						String extension = FilenameUtils.getExtension(origin)
						String idfname = newAttachment.fileName
						byte[] byteData = f.getBytes()
						newAttachment.urlPath = uploadPhotos(activeCase, byteData, idfname)
						fileAttachmentRepository.save(newAttachment)
					} catch (Exception e) {
						e.printStackTrace()
						throw e
					}
			}
		}
		catch (Exception e) {
			e.printStackTrace()
			throw e
		}

		return new ResponseEntity<>(
				"Success Uploading Files",
				HttpStatus.OK)

	}

	@Transactional
	@RequestMapping(method = RequestMethod.POST, value = "/api/orderSlips/addresultsimages")
	ResponseEntity<String> addresultsimages(@RequestParam String id, MultipartRequest request) {

		OrderSlipItem orderSlipItem = orderSlipItemRepository.findById(UUID.fromString(id)).get()

		def attachement = request.getFiles("file")

		try {
			attachement.forEach { file ->
				MultipartFile f = file
				DiagnosticResult uploadedResult = new DiagnosticResult()
//                resutSlipResource.data = file.bytes.toTypedArray()
				uploadedResult.file_name = f.originalFilename
				uploadedResult.mimetype = f.contentType
				uploadedResult.service = orderSlipItem.service
				uploadedResult.orderSlipItem = orderSlipItem
				try {
					/*** ready for NAS***/
					String origin = f.resource.filename
					String extension = FilenameUtils.getExtension(origin)
					String idfname = uploadedResult.file_name
					byte[] byteData = f.getBytes()
					uploadedResult.url_path = resultWitterOnSmb(orderSlipItem, byteData, idfname)
					diagnosticsResultRepository.save(uploadedResult)
				} catch (Exception e) {
					e.printStackTrace()
					throw e
				}
			}

		} catch (Exception e) {
			e.printStackTrace()
			throw e
		}

		return new ResponseEntity<>(
				"Success Uploading Files",
				HttpStatus.OK)
	}

	String uploadPhotos(Case patientCase, byte[] byteData, String fname) {
		String url = null

		try {

			IntegrationConfig integrationConfig = integrationConfigRepository.findAll().first()
			NtlmPasswordAuthentication ntlmPasswordAuthentication = new NtlmPasswordAuthentication(null, integrationConfig.smbUser, integrationConfig.smbPass)

			def shared = integrationConfig.nasLocation

			String pFolder = patientCase.patient.patientNo.toString() + "/"
			String finalName = StringUtils.trim(fname)
			SmbFile sFile = new SmbFile(shared + pFolder, ntlmPasswordAuthentication)

			if (folderCreator(sFile)) {
				SmbFile sFile1 = new SmbFile(shared + pFolder + "photos/", ntlmPasswordAuthentication)
				folderCreator(sFile1)
			}

			url = shared + pFolder + 'photos/' + finalName
			SmbFile sFileFinal = new SmbFile(url, ntlmPasswordAuthentication)

			SmbFileOutputStream sfos = new SmbFileOutputStream(sFileFinal)
			sfos.write(byteData)
			sfos.flush()
			sfos.close()

		} catch (Exception e) {
			e.printStackTrace()
			throw e
		}

		return url
	}

	String resultWitterOnSmb(OrderSlipItem orderSlipItem, byte[] byteData, String fname) {

		// var hospInfo = hospitalInfoRepository.findAll().firstOrNull()
		String tofile = null
		try {

			IntegrationConfig integrationConfig = integrationConfigRepository.findAll().first()

//			NtlmPasswordAuthentication ntlmPasswordAuthentication = new NtlmPasswordAuthentication(null, "hisd3", "xsXY4;")
			NtlmPasswordAuthentication ntlmPasswordAuthentication = new NtlmPasswordAuthentication(null, integrationConfig.smbUser, integrationConfig.smbPass)

			def shared = integrationConfig.nasLocation

			//def shared = "smb://172.16.12.30/Diagnostics/HISMKII/"

			SmbFile directory = new SmbFile(shared, ntlmPasswordAuthentication)

//          val path = shared + orderSlip.patientID +"/"+orderSlip?.serviceFee?.department + "/" + orderSlip.serviceFee?.category + "/"
//          var pFolder = if (hospInfo?.live_deployment!!) orderSlip.pdsc?.patient?.patientNo.toString() + "/" else "DEMO" + orderSlip.pdsc?.patient?.patientNo.toString() + "/"

			String pFolder = orderSlipItem.orderslip.parentCase.patient.patientNo.toString() + "/"
			String dFolder = StringUtils.trim(orderSlipItem.service.serviceName).replace(" ", "") + "/"
			String caseFolder = StringUtils.trim(orderSlipItem.itemNo.toString()) + "/"
			String finalName = StringUtils.trim(fname)

			SmbFile sFile = new SmbFile(shared + pFolder, ntlmPasswordAuthentication)

			if (folderCreator(sFile)) {
				SmbFile sFile1 = new SmbFile(shared + pFolder + caseFolder, ntlmPasswordAuthentication)
				folderCreator(sFile1)
//				if (folderCreator(sFile1)) {
//
//					SmbFile sFile2 = new SmbFile(shared + pFolder + caseFolder + dFolder, ntlmPasswordAuthentication)
//
//					folderCreator(sFile2)
//				}
			}

			tofile = shared + pFolder + caseFolder + finalName
			SmbFile sFileFinal = new SmbFile(tofile, ntlmPasswordAuthentication)

			SmbFileOutputStream sfos = new SmbFileOutputStream(sFileFinal)
			sfos.write(byteData)
			sfos.flush()
			sfos.close()
		} catch (Exception e) {

			e.printStackTrace()
			throw e
		}

		return tofile
	}

	Boolean folderCreator(SmbFile sFile) {

		try {
			if (!sFile.exists()) {
				sFile.mkdir()
			}
		} catch (IOException e) {
			//throw IllegalArgumentException(e.message)
			e.printStackTrace()
		}
		return true
	}

	@RequestMapping(method = RequestMethod.GET, value = "/api/orderSlipItems/report")
	ResponseEntity<AnyDocument.Any> downloadOrderSlipItems(@RequestParam String category,
	                                                       @RequestParam String status,
	                                                       @RequestParam String reader,
	                                                       @RequestParam String start,
	                                                       @RequestParam String end)

	{

		//Pageable pageable =  PageRequest.of(page, pageSize) //,Sort.Direction.DESC, 'createdDate'

		Timestamp startTimeS = Timestamp.valueOf(start)
		Timestamp endTimeS = Timestamp.valueOf(end)

		Instant startDate = startTimeS.toInstant()
		Instant endDate = endTimeS.toInstant()

		List<OrderSlipItem> results = orderSlipItemRepository.getAllSelectedResults(status, category, startDate, endDate).sort{it.created}

		//List<OrderSlipItem> itemList = results.getContent();
		StringBuffer buffer = new StringBuffer()

		DateTimeFormatter formatter =
				DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss").withZone(ZoneId.systemDefault())
		CSVPrinter csvPrinter = new CSVPrinter(buffer, CSVFormat.POSTGRESQL_CSV
				.withHeader("Type", "PIN", "Patient", "Acession", "Category", "Service", "Status", "Date", "BasePrice", "Price", "Reader's " +
				"Fee", "Wave/Discount", "Attending", "Requesting","Reader"))

		try {
			for (def item : results) {
				BigDecimal rF = item.service?.readersFee

				if(item?.billing_item?.rfFee!=null){
					rF = item?.billing_item?.rfFee
					println("RF null : "+rF)
				}
				else{
					println("RF : "+rF +" | service : "+item?.service.serviceName)
				}



				csvPrinter.printRecord(
						item.orderslip?.parentCase?.registryType ?: "",
						item.orderslip?.parentCase?.patient?.patientNo,
						item.orderslip?.parentCase?.patient?.fullName,
						item.accession ?: "",
						item.service?.department?.departmentName,
						item.service?.serviceName,
						item.status,
						formatter.format(item.created),
						item.service?.basePrice,
						item.billing_item?.debit,
						rF,
						item.waved,
						item.orderslip?.parentCase?.attendingPhysician?.fullnameWithTitle,
						item.orderslip?.requestingPhysicianName,
						item.reader?.fullName
				)
			}

			LinkedMultiValueMap<String, String> extHeaders = new LinkedMultiValueMap<>()
			extHeaders.add("Content-Disposition", "inline;filename=Ancillary-Report.csv")

			return new ResponseEntity(String.valueOf(buffer).getBytes(), extHeaders, HttpStatus.OK)
		}
		catch (e) {
			throw e
		}

	}

	@RequestMapping(method = RequestMethod.GET, value = "/api/downloadInpatientReport/report")
	ResponseEntity<AnyDocument.Any> downloadInpatientReport(@RequestParam String start,
	                                                       @RequestParam String end)

	{

		DateTimeFormatter formatter =
				DateTimeFormatter.ofPattern("yyyyMMdd").withZone(ZoneId.systemDefault())

		LocalDate localDateStart = LocalDate.parse(start.substring(0,10));
		LocalDate localDateEnd = LocalDate.parse(end.substring(0,10));


		//List<OrderSlipItem> itemList = results.getContent();
		StringBuffer buffer = new StringBuffer()


		String query = """
						SELECT pt.patient_no,
    cs.case_no AS "Case Number",
    to_char((cs.admission_datetime + '08:00:00'::interval), 'MM/DD/YYYY'::text) AS "Admission Date",
    to_char((cs.admission_datetime + '08:00:00'::interval), 'hh12:mi AM'::text) AS "Admission Time",
    to_char((cs.admission_datetime + '08:00:00'::interval), 'MM/DD/YYYY hh12:mi AM'::text) AS "Admission Date and Time",
    pt.first_name AS "Firstname",
    pt.middle_name AS "Middlename",
    pt.last_name AS "Lastname",
    pt.name_suffix AS "Suffix",
    to_char((pt.dob)::timestamp with time zone, 'YYYY'::text) AS "Year",
    to_char((pt.dob)::timestamp with time zone, 'MM'::text) AS "Month",
    to_char((pt.dob)::timestamp with time zone, 'DD'::text) AS "Day",
    to_char((pt.dob)::timestamp with time zone, 'MM/DD/YYYY'::text) AS "Birth Date",
    date_part('year'::text, age(((cs.admission_datetime)::date)::timestamp with time zone, (pt.dob)::timestamp with time zone)) AS "Age",
    date_part('year'::text, age(((cs.admission_datetime)::date)::timestamp with time zone, (pt.dob)::timestamp with time zone)) AS "Age_Years",
    date_part('month'::text, age(((cs.admission_datetime)::date)::timestamp with time zone, (pt.dob)::timestamp with time zone)) AS "Age_Month",
    date_part('day'::text, age(((cs.admission_datetime)::date)::timestamp with time zone, (pt.dob)::timestamp with time zone)) AS "Age_Day",
    pt.gender AS "Gender",
    ltrim(concat(pt.address, ' ', pt.barangay, ' ', pt.city_municipality, ' ', pt.state_province, ' ', pt.country, ' ', pt.zip_code, ' ')) AS "Address",
    cs.accommodation_type AS "Membership",
    cs.admitting_diagnosis AS "Admitting Diagnosis",
    ( SELECT (((hrmemp.first_name)::text || ' '::text) || (hrmemp.last_name)::text) AS admitting_physician
           FROM hrm.employees hrmemp
          WHERE (hrmemp.id = cs.admitting_physician)) AS "Admitting Physician",
    (((emp.first_name)::text || ' '::text) || (emp.last_name)::text) AS "Attending Physician",
    to_char((cs.discharged_datetime + '08:00:00'::interval), 'MM/DD/YYYY hh12:mi AM'::text) AS "Discharge Date and Time",
    to_char((cs.discharged_datetime + '08:00:00'::interval), 'MM/DD/YYYY'::text) AS "Discharge Date ",
    to_char((cs.discharged_datetime + '08:00:00'::interval), 'hh12:mi AM'::text) AS "Discharge Time",
    cs.discharge_disposition AS "Disposition",
    cs.discharge_condition AS "Condition",
    cs.discharge_diagnosis AS "Final Diagnosis"
   FROM ((pms.cases cs
     LEFT JOIN pms.patients pt ON ((pt.id = cs.patient)))
     LEFT JOIN hrm.employees emp ON ((emp.id = cs.attending_physician)))
  WHERE ((cs.registry_type)::text = 'IPD'::text) and (cs.admission_datetime + '08:00:00'::interval) BETWEEN TO_DATE('${localDateStart.format(formatter)}','YYYYMMDD') and TO_DATE('${localDateEnd.format(formatter)}','YYYYMMDD')
  ORDER BY cs.admission_datetime;"""



		CSVPrinter csvPrinter = new CSVPrinter(buffer, CSVFormat.POSTGRESQL_CSV
				.withHeader("Patient No",
				"Case Number",
				"Admission Date",
				"Admission Time",
				"Admission Date and Time",
				"Firstname",
				"Middlename",
				"Lastname",
				"Suffix",
				"Year",
				"Month",
				"Day", "Birth Date","Age","Age_Years","Age_Month","Age_Day","Gender",
				"Address","Membership","Admitting Diagnosis","Admitting Physician",
				"Attending Physician","Discharge Date and Time","Discharge Date","Discharge Time","Disposition","Condition","Final Diagnosis"))

		def results = jdbcTemplate.queryForList(query)

		try {
			for (def item : results) {
				csvPrinter.printRecord(
						item["patient_no"]?: "",
						item["Case Number"]?: "",
						item["Admission Date"]?: "",
						item["Admission Time"]?: "",
						item["Admission Date and Time"]?: "",
						item["Firstname"]?: "",
						item["Middlename"]?: "",
						item["Lastname"]?: "",
						item["Suffix"]?: "",
						item["Year"]?: "",
						item["Month"]?: "",
						item["Day"]?: "",
						item["Birth Date"]?: "",
						item["Age"]?: "",
						item["Age_Years"]?: "",
						item["Age_Month"]?: "",
						item["Age_Day"]?: "",
						item["Gender"]?: "",
						item["Address"]?: "",
						item["Membership"]?: "",
						item["Admitting Diagnosis"]?: "",
						item["Admitting Physician"]?: "",
						item["Attending Physician"]?: "",
						item["Discharge Date and Time"]?: "",
						item["Discharge Date"]?: "",
						item["Discharge Time"]?: "",
						item["Disposition"]?: "",
						item["Condition"]?: "",
						item["Final Diagnosis"]?: ""
				)
			}
			String filename = """Inpatient_${localDateStart.format(formatter)}_${localDateEnd.format(formatter)}.csv"""
			LinkedMultiValueMap<String, String> extHeaders = new LinkedMultiValueMap<>()
			extHeaders.add("Content-Disposition", 'inline;filename="'+filename+'"')
			return new ResponseEntity(String.valueOf(buffer).getBytes(), extHeaders, HttpStatus.OK)
		}
		catch (e) {
			throw e
		}
	}

	@RequestMapping(method = RequestMethod.GET, value = "/api/orderSlipItems/report2")
	ResponseEntity<AnyDocument.Any> downloadOrderSlipItems2(@RequestParam String category,
														   @RequestParam String status,
														   @RequestParam String reader,
														   @RequestParam String start,
														   @RequestParam String end)

	{

		//Pageable pageable =  PageRequest.of(page, pageSize) //,Sort.Direction.DESC, 'createdDate'

		Timestamp startTimeS = Timestamp.valueOf(start)
		Timestamp endTimeS = Timestamp.valueOf(end)

		Instant startDate = startTimeS.toInstant()
		Instant endDate = endTimeS.toInstant()

		Set<Department> uniDept = []

		Department myDept = departmentRepository.findById(UUID.fromString(category)).get()

		if(myDept?.parentDepartment){
			uniDept.add(myDept)
		}
		else{
			List<Department> childDept = departmentRepository.getSubDepartments(myDept.id)
			if(childDept.size() > 0){
				for (def item : childDept) {
					uniDept.add(item)
				}
			}

		}

		StringBuffer mainBuffer = new StringBuffer()

		DateTimeFormatter formatter =
				DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss").withZone(ZoneId.systemDefault())
		CSVPrinter csvPrinter = new CSVPrinter(mainBuffer, CSVFormat.POSTGRESQL_CSV.withHeader("","DEPARTMENT", "IN-PATIENT", "IN-PATIENT CHARGES", "OUT-PATIENT", "OUT-PATIENT CHARGES", "TOTAL", "TOTAL CHARGES"))

		uniDept.each {

			department ->
				//def res =  orderSlipItemRepository.getAllSelectedResults(status,department.id.toString(), startDate, endDate).sort{it.created}

				def results = jdbcTemplate.queryForList( """
				Select s.servicename,d.department_name, count(1) FILTER ( WHERE c.registry_type = 'IPD' and b.status='ACTIVE') as INPATIENT,
                        SUM(b.debit)
										FILTER ( WHERE c.registry_type = 'IPD' and b.status='ACTIVE' ) as INPATIENT_CHARGES,
					   count(1) FILTER ( WHERE c.registry_type != 'IPD' and b.status='ACTIVE' ) as OPD,
					   SUM(b.debit)
						   FILTER ( WHERE c.registry_type != 'IPD' and b.status='ACTIVE' ) as OPD_CHARGES,
						    count(1) as TOTAL,
					  SUM(b.debit) as TOTAL_Charges
						from ancillary.orderslip_item osi
						  left join billing.billing_item b on osi.billing_item = b.id
						  left join ancillary.services s on osi."service" = s.id
						  left join public.departments d on s.department = d.id
						  left join ancillary.orderslips o on osi.orderslip = o.id
						  left join pms.cases c on o.case_number = c.id
						  left join pms.patients p on c.patient = p.id
				where osi.billing_item is not null and osi.status ='COMPLETED' 
				and d.department_name = ?
				and osi.created_date between ? and ?
				GROUP BY s.servicename,d.department_name;
				""",
						department.departmentName,
						startTimeS,
						endTimeS
				)

				csvPrinter.printRecord(department.departmentName)
				BigDecimal total_inp = 0
				BigDecimal totol_inp_charges =0
				BigDecimal total_opd = 0
				BigDecimal total_opd_charges = 0
				BigDecimal total_in_department = 0
				BigDecimal total_dept_charges = 0

				results.each {
					item->
					csvPrinter.printRecord(
							item["servicename"]?: "",
							item["department_name"]?: "",
							item["inpatient"]?: "",
							item["inpatient_charges"]?: "",
							item["opd"]?: "",
							item["opd_charges"]?: "",
							item["total"]?: "",
							item["total_charges"]?: "",
					)
						total_inp += new BigDecimal(item["inpatient"].toString())
						totol_inp_charges +=item["inpatient_charges"]? new BigDecimal(item["inpatient_charges"].toString()) : BigDecimal.ZERO
						total_opd += new BigDecimal(item["opd"].toString())
						total_opd_charges += item["opd_charges"] ? new BigDecimal(item["opd_charges"].toString()) : BigDecimal.ZERO
						total_in_department += item["total"] ? new BigDecimal(item["total"].toString()) : BigDecimal.ZERO
						total_dept_charges +=item["total_charges"]?  new BigDecimal(item["total_charges"].toString()) : BigDecimal.ZERO

				}

				csvPrinter.printRecord("","-",total_inp,totol_inp_charges,total_opd,total_opd_charges,total_in_department,total_dept_charges)

		}

			LinkedMultiValueMap<String, String> extHeaders = new LinkedMultiValueMap<>()
			extHeaders.add("Content-Disposition", "inline;filename=Ancillary-Report.csv")

			return new ResponseEntity(String.valueOf(mainBuffer).getBytes(), extHeaders, HttpStatus.OK)

	}


//	 writeToFileApacheCommonIO(StringBuffer file, String msg) {
//		 BufferedWriter bufferedWriter
//		 try {
//
//			 file.append(msg)
//			 bufferedWriter.close()
//			 return file
//		 } catch (IOException e) {
//			 e.printStackTrace()
//		 }
//	}

	@RequestMapping(method = [RequestMethod.GET], value = "/api/updaterf/{department}")
	ResponseEntity<String> updaterf(@PathVariable(value = "department") String department) {
		HttpHeaders responseHeaders = new HttpHeaders()
		List<Service> results = serviceRepository.searchByDepartment(department)

		if(results.size() > 0 ){
			results.each {
				if (it.readersFee > 0) {
					def percentage = (it.readersFee / it.basePrice) * 100

					it.rfPercentage = percentage
					serviceRepository.save(it)
				}
			}
		}
		return new ResponseEntity(responseHeaders, HttpStatus.OK)
	}



	@RequestMapping(method = [RequestMethod.GET], value = "/api/patchBillingItemRf")
	ResponseEntity<String> patchBillingItemRf(@RequestParam String start,
											  @RequestParam String end) {
		HttpHeaders responseHeaders = new HttpHeaders()

		Timestamp startTimeS = Timestamp.valueOf(start)
		Timestamp endTimeS = Timestamp.valueOf(end)

		Instant startDate = startTimeS.toInstant()
		Instant endDate = endTimeS.toInstant()
		String status = 'COMPLETED'

		List<OrderSlipItem> results = orderSlipItemRepository.getAllCompletedByDate(status,startDate, endDate).sort{it.created}

		if(results.size() > 0 ){
			results.each {
				if (it.billing_item ) {
					if(!it.billing_item.rfFee){
						setDefaultRf(it)
					}

				}
			}
		}
		return new ResponseEntity(responseHeaders, HttpStatus.OK)
	}


	def setDefaultRf(OrderSlipItem osItem){

		def billingItemDto = billingItemRepository.findById(osItem.billing_item.id).get()

		if(osItem.reader){
			List<RfFees> rfFees = rfFeesRepository.searchMatch(osItem.service.id,osItem.reader.id)
			if(rfFees.size() > 0){
				billingItemDto.rfFee = billingItemDto.debit * (rfFees[0].rfPercentage / 100)

				def o = new RfDetails()
				o.rfTableId = rfFees[0].id
				o.doctorsId = osItem.reader.id
				o.serviceId = osItem.service.id
				o.percentage = rfFees[0].rfPercentage
				billingItemDto.rfDetails = new JsonBuilder( o ).toString()
			}
			else{

				def percentage = 0
				billingItemDto.rfFee = BigDecimal.ZERO

				if(osItem.service.readersFee> 0){
					percentage = (osItem.service.readersFee /osItem.service.basePrice)
					billingItemDto.rfFee = billingItemDto.debit * percentage
				}

				def o = new RfDetails()
				o.doctorsId = osItem.reader.id
				o.serviceId = osItem.service.id
				o.percentage = percentage * 100
				billingItemDto.rfDetails = new JsonBuilder( o ).toString()
			}
			billingItemRepository.save(billingItemDto)
		}

		return
	}


    @RequestMapping(method = [RequestMethod.GET], value = "/api/testOrderSlipResultDataTest/{caseid}/{service}", produces = MediaType.APPLICATION_JSON_VALUE)
    ResponseEntity<String> testOrderSlipResultDataTest(@PathVariable(value = "caseid") UUID caseid, @PathVariable(value = "service") String service) {
        String query =
                """select os.case_number, (dr."data"::json)->'parameterData'->'observationrequest' as "service", dr."data", dr.created_date + interval '8 hour' as "date" from ancillary.diagnostic_results dr
                    left join ancillary.orderslip_item oi on dr.orderslip_item = oi.id
                    left join ancillary.orderslips os on oi.orderslip = os.id
                    left join ancillary.services srv on srv.id = oi.service
                    where dr.mimetype is null and os.case_number = '$caseid'  and (dr."data"::json)->'parameterData'->>'observationrequest' = '$service' 
                    order by srv.description, dr.created_date
                    """
        def results = jdbcTemplate.queryForList(query)
        JSONArray array = new JSONArray();

        JSONObject referenceValues = null;
        JSONObject referenceUnits = null;
        Boolean referencesDone = false;
        results.each {
            String json = it.get("data").toString()
            JsonObject convertedObject = new Gson().fromJson(json, JsonObject.class);
            JSONObject myObject = new JSONObject();
            Date date = it.get("date") as Timestamp;
            SimpleDateFormat formatter = new SimpleDateFormat("MM/dd/yyyy hh:mm aa");
            myObject.put("date",formatter.format(date))
            //println date
            convertedObject.get("labResultsList").asJsonArray.each {
                if(!it.getAt("fieldname").toString().contains("Remarks:"))
                {
                    try{
                        if(referenceValues==null)
                        {
                            referenceValues = new JSONObject();
                            referenceUnits = new JSONObject();
                        }
                        referenceValues.put(it.getAt("fieldname").toString().replace('\"',""), it.getAt("cu_referencerange").toString().replace('\"',""))
                        referenceUnits.put(it.getAt("fieldname").toString().replace('\"',""),it.getAt("cu_units").toString().replace('\"',""))
                        myObject.put(it.getAt("fieldname").toString().replace('\"',""), Double.parseDouble(it.getAt("value").toString().replace('\"',"")))
                    }
                    catch (Exception e)
                    {
                        e.printStackTrace()
                        if(convertedObject.get(" labResultsList").asJsonArray.size()==1)
                            throw new IllegalArgumentException("Can't display as chart!")
                    }

                }
            }
            if(!referencesDone){
                array.put(referenceValues)
                array.put(referenceUnits)
                referencesDone = true
            }

            array.put(myObject)
        }
        return new ResponseEntity<String>(array.toString(), HttpStatus.OK);
    }

    @RequestMapping(method = [RequestMethod.GET], value = "/api/testOrderSlipResultData/{caseid}")
    List<String> testOrderSlipResultData(@PathVariable(value = "caseid") UUID caseid) {
        List<String> services = new ArrayList<>()
        String query =
                """select os.case_number, (dr."data"::json)->'parameterData'->>'observationrequest'::VARCHAR as "service", dr.created_date from ancillary.diagnostic_results dr
                    left join ancillary.orderslip_item oi on dr.orderslip_item = oi.id
                    left join ancillary.orderslips os on oi.orderslip = os.id
                    left join ancillary.services srv on srv.id = oi.service
                    where dr.mimetype is null and os.case_number = '$caseid'
                    order by srv.description, dr.created_date
                    """
        def results = jdbcTemplate.queryForList(query)
        results.each {
            println it.get("service").toString()
            services.add(it.get("service").toString())
        }

       return services.toSet().toList()
    }
}
